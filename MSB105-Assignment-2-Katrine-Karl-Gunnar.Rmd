---
title: "Har en persons høyde innvirkning på lønnen?"
subtitle: "Assignment 2 i MSB105 Data Science - innleveringsfrist 12.10.20"
author: 
  - Katrine Hope
  - Karl-Gunnar Severinsen
classoption: twoside
fontsize: 12pt
linestretch: 1.5
output: html_notebook
---


```{r setup, echo = FALSE}
library(modelr)
library(ggplot2)
library(knitr)
library(tinytex)
library(tidyverse)
library(ggpubr)
library(dplyr)
options(scipen = 999)
```

## Introduksjon


## Analyse

### Oversikt

Vi starter med å lage en kolonne der høyden er vist i centimeter og inntekten i nnorske kroner. 
Vi gjør dette for å kunne få en bedre og mer forståelig analyse, da vi vil få en bedre forståelse ved å benytte kjente verdier. 
Deretter sorterer vi utvalget i datasettet inn i 10 intervaller med sammendragsstatistikk, for å gi en kjapp oversikt:

```{r oversikt, echo=FALSE}
heights$inntekt <- heights$income*9
heights$height_cm <- heights$height*2.54
heights$height_cmInt <- cut(heights$height_cm, breaks = 8)
kable(summary(heights[,3:7]))
kable(summary(heights[,8:11]))
```

Her ser vi statistikk på blant annet vekt (i lbs), alder, sivilstatus, kjønn og utdanning inntekt i NOK og høyde (i cm).

Under kjører vi samme oversikten, der vi ønsker se på hvordan den ser ut dersom vi begrenser inntekten til 1.600.000 NOK.
Vi ønsker å gjøre dette får å utelukke de høye variablene som i følge *help-funksjonen* er beregnet gjennomsnittsinntekt av de 2 prosentene med høyest lønn.

```{r}
heights_liminc <- heights %>%
  filter(inntekt < 1600000)

kable(summary(heights_liminc[,3:7]))
kable(summary(heights_liminc[,8:11]))
```


### 1-variabels analyser

Videre har vi laget noen forskjellige oversikter for variablene *height_cm* og *inntekt* for å kunne vurdere om variablene er normalfordelte eller ikke. 
Vi starter med et histogram.

```{r histogram, echo=FALSE}
height_cm <- heights$height_cm
hist(height_cm, breaks = 20,
     main = "Høyde i centimeter",
     xlab = "Centimeter",
     ylab = "Frekvens",
     col = "darkmagenta")
```

I histogrammet over ser vi høyde i centimeter opp mot frekvens. 
Histogrammet reflekterer *height_cmInt* fra oversikten i forrige kapittel.
Vi kan også se at fordelingen er tilnærmet normalfordelt, med hovedvekten av observasjonene ligger mellom 160 til 180 centimeter.


```{r}
hist(height_cm, breaks = 20,
     main = "Høyde i centimeter",
     xlab = "Centimeter",
     ylab = "Frekvens",
     col = "darkmagenta")
xfit <- seq(min(height_cm), max(height_cm))
yfit <- dnorm(xfit,mean = mean(height_cm), sd = sd(height_cm))
yfit <- yfit*diff(heights$height_cm[1:2])*length(height_cm)
lines(xfit, yfit, col = "yellow", lwd = 4)
```

```{r density høyde, echo=FALSE}
ggplot(data = heights) +
  geom_density(aes(x = height_cm),
                   fill = "darkmagenta")
```

Over har vi et density plot, som i grunn viser det samme som histogrammet over, men ved hjelp av en jevn kurve som viser tettheten av observasjonene.
Igjen ser vi at fordelingen er tilnærmet normalfordelt.

Vi ønsker også å se på fordelingen i inntekt. 

```{r density inntekt, echo=FALSE}
ggplot(data = heights) +
  geom_density(aes(x = inntekt),
                   fill = "darkmagenta")
```

Her ser vi tydelig at inntekten ikke er normalfordelt.
Dette har sammenheng med at det er mange observasjoner rundt 0, samt de 2% med høyest lønn er vist ved et gjennomsnitt av deres lønn.
Dette medfører null observasjoner mellom 1.700.000 og 3.000.000, og en stor tetthet rundt 3-400.000.
Vi så også dette tidligere i oversikten, der vi får en median på 266.000 og et gjennomsnitt på 370.000.

### 2-variablers analyse

Vi har til nå sett på variablene *height_cm* og *inntekt* hver for seg.
For å kunne vurdere om de har noe sammenheng, må vi putte dem inn i samme plot.

Vi velger å kjøre to *plots* side ved side nedover.
Plottet til venstre vil inneholde alle observasjonene fra datasettet, som da inkluderer *outliers*.
På høyresiden har vi valgt å begrense inntekten til 1.600.000 NOK, da dette vil ekskludere de øverste 2% som kan være forstyrrende for å få et korrekt bilde av analysen.

```{r height-income, echo=FALSE}
heights_liminc <- heights %>%
  filter(inntekt < 1600000)

m1 <- ggplot(heights, 
             mapping = aes(x = height_cm, 
                           y = inntekt, 
                           col = inntekt)) +
  geom_point()
m2 <- ggplot(heights_liminc, 
             mapping = aes(x = height_cm, 
                           y = inntekt, 
                           col = inntekt)) +
  geom_point()

ggarrange(m1,m2)
```
Til venstre ser vi ulempen med å inkludere de med høyest lønn, da det ikke er noen observasjoner overhodet mellom 1.600.000 og 3.000.000.
Vi kan også se at de på toppen er fordelt gjennom hele høydespekteret.

I begge plottene kan vi for øvrig se at alle observasjonene er jevnt fordelt over hele høyde- og inntektsspekteret.
Dette kan være en indikasjon på at høyde ikke har noe relevans for hvor mye en person tjener.

Vi kan også vise dette ved hjelp av et *boxplot*, der vi grupperer observasjonene i høydeintervaller på 10cm per boks.

```{r boxplot, echo=FALSE}
m3 <- ggplot(heights,
                mapping = aes(
                  x = height_cmInt,
                  y = inntekt)) +
        geom_boxplot(colour= "darkred",
                     fill = "cornflowerblue") +
  theme(panel.background = element_rect(fill = "pink"))
m4 <- ggplot(heights_liminc, 
               mapping = aes(
                 x = height_cmInt, 
                 y = inntekt)) +
        geom_boxplot(colour = "darkred",
                     fill = "darkolivegreen") +
  theme(panel.background = element_rect(fill = "pink"))

ggarrange(m3, m4)
```

I *boxplottet* der selve boksen representerer første og tredje kvantil, i tillegg ser vi medianen i form av streken som går gjennom hver boks. 
De tynne strekene over/under boksene, kalles *whiskers*, og inkluderer observasjoner inntil 1.5% utover boksene.

Vi får her i stor grad det samme bilde som i plottet over. 
I dette tilfellet får vi *outliers* i begge grafene, noe som har en sammenheng med at både median- og gjennomsnittslønn er relativt lav i forhold til alle observasjonene.
Vi ser at vi kunne redusert *outliers* ytterliggere ved å begrense datasettet til å kun inkludere de med inntekt opp til 1.000.000, men vi føler ikke dette vil gi et like riktig bilde.



```{r jitter, echo=False}
m5 <- ggplot(heights, 
             mapping = aes(x = height_cm, 
                           y = inntekt)) +
  geom_point(position = "jitter") +
  geom_smooth(method = 'lm')

m6 <- ggplot(heights_liminc, 
             mapping = aes(x = height_cm, 
                           y = inntekt)) +
  geom_point(position = "jitter") +
  geom_smooth(method = 'lm')

ggarrange(m5, m6)
```
I modellene over har vi valgt å bruke *geom_jitter* som viser resultatet litt mer spredt slik at vi får litt mer "*støy*", siden dataene smelte litt mer sammen. Når vi da velger å legge inn kommandoen *geom_smooth* ser vi at regresjonslinjen kommer mer til uttrykk. Vi ser at helningen til regresjonslinjen til venstre er høyere enn regresjonslinken til modellen til høyre, dette kommer av at når vi begrenser maks inntekt til kr 1 600 000 unngår vi gjennomsnittsinntekten av de 2 prosentene med høyest lønn som påvirker datasettet mye. 

### Regresjon

```{r}
summary(lm(inntekt ~ height_cm, data = heights))
```

```{r}
summary(lm(inntekt ~ education + height_cm + sex + weight + afqt + marital, data = heights))
```



## Referanser


